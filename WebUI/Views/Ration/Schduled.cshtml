@model WebUI.Models.RationScheduleViewModelNew
@*@model IEnumerable<Geography.PorjectModels.TblCount>*@

@{
    ViewBag.Title = "Schduled";
}
<link href="~/Content/Site.css" rel="stylesheet" />
<h2>Schduled</h2>
<header>
    <a href="/Ration/Dashboard">Back to Dashboard</a>

</header>

@using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div class="form-horizontal">

        @Html.AntiForgeryToken()


        @Html.ValidationSummary(true, "", new { @class = "text-danger" })


        <div id="FoodItem">
            <div class="form-group">
                <div class="col-md-10">
                    <label>Start Date</label>
                    @Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly", @id = "StartingDate" } })
                    <br />
                    <input type="submit" value="Create" id="GetSchdule" class="btn btn-primary" />

                    <span id="ErrorDateStartMsg" style="color:red;"></span>

                </div>
            </div>

        </div>
    </div>


    if (Model.lstRationScheduleViewModel != null && Model.lstRationScheduleViewModel.Count > 0)
    {
        <table class="table" table-bordered="">
            <caption></caption>
            <colgroup>
                <col>
                <col>
            </colgroup>
            <colgroup span="3"></colgroup>
            <thead>
                <tr>
                    <th scope="col"> Schedule Date</th>
                    <th scope="col">PacketId </th>
                    <th scope="col">Packet Type</th>
                    <th scope="col">Packet Content</th>
                    <th scope="col">Calories</th>
                    <th scope="col">Expiry Date</th>
                    <th scope="col">QtyInLtrs</th>
                </tr>
            </thead>

            @foreach (var item in Model.lstRationScheduleViewModel)
            {
                bool isFrist = true;
                <tbody>

                    @foreach (var itemration in item.listRation)
                    {
                        <tr>
                            @if (isFrist)
                            {
                                <th rowspan="@item.CounterSpan" scope="rowgroup">@item.StartDate.ToString("dd/MM/yyyy")</th>
                                isFrist = false;
                            }

                            <th scope="row">@itemration.Id</th>
                            <td>@itemration.PacketType</td>
                            <td>@itemration.PacketContent</td>
                            <td>
                                @if (@itemration.Calories == 0)
                                {
                                    var valCal = "-";
                                    @valCal;
                                }
                                else
                                {
                                    @itemration.Calories

                                }
                            </td>
                            <td>@itemration.ExpiryDate</td>
                            <td>
                                @if (@itemration.LitersQty == 0)
                                {
                                    var valLtr = "-";
                                    @valLtr;
                                }
                                else
                                {
                                    @itemration.LitersQty

                                }
                            </td>
                        </tr>

                    }
                </tbody>
            }

        </table>
        <p id="DisplayInventory">Number of days you can survive with current inventory : @Model.lstRationScheduleViewModel.OrderByDescending(a => a.LivedLife).FirstOrDefault().LivedLife<span id="LifeNumber"></span></p>

    }

}


@section Scripts {

    <script type="text/javascript">

        $(document).ready(function () {
            $("#StartingDate").addClass("calender");
           // $("#StartingDate").val("");

            $("form").attr('autocomplete', 'off');

            $('#StartingDate').datepicker({
                dateFormat: "dd/M/yy",
                changeMonth: true,
                minDate: 0,
                changeYear: true,
            });

            $("#StartingDate").keypress(function (e) {
                if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                    $("#StartDateError").html("Pick Date Only").show().fadeOut("slow");
                    return false;
                } else {
                    $("#StartDateError").text("");
                }
            });

        });

       

    </script>
}
